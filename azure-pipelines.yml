trigger:
  - "*"

pool:
  name: Default

variables:
  buildConfiguration: "Release"
  rootDir: 'Tailspin.SpaceGame.Web'
  wwwrootDir: 'Tailspin.SpaceGame.Web/wwwroot'
  dotnetSdkVersion: '9.x'

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: "22.x"
    displayName: "Install Node.js and npm"

  - script: npm install
    workingDirectory: $(rootDir)
    displayName: "Install npm packages"

  - script: |
      node_modules\.bin\sass $(wwwrootDir):$(wwwrootDir)
    displayName: "Compile Sass assets"

  - script: npm exec -- gulp
    workingDirectory: $(rootDir)
    displayName: "Run gulp tasks"

  - script: 'echo "$(Build.DefinitionName), $(Build.BuildId), $(Build.BuildNumber)" > buildinfo.txt'
    displayName: "Write build info"
    workingDirectory: $(wwwrootDir)

  - task: DotNetCoreCLI@2
    displayName: "Restore project dependencies"
    inputs:
      command: "restore"
      projects: "**/*.csproj"

  - template: templates/build.yml
    parameters:
      buildConfiguration: 'Debug'

  - template: templates/build.yml
    parameters:
      buildConfiguration: 'Release'

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact: drop'
    condition: succeeded()